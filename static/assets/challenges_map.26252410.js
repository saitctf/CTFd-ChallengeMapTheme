import{m as o,C as i,h as g,T as r,d,M as c,a as p}from"./index.b6be5691.js";function m(){return new Promise(e=>{if(window.Raphael&&window.jQuery&&window.jQuery.mapael){e();return}const s=["/themes/CTFd-ChallengeMapTheme/static/assets/raphael.min.js","/themes/CTFd-ChallengeMapTheme/static/assets/jquery.mapael.js","/themes/CTFd-ChallengeMapTheme/static/assets/usa_states.js"];let t=0;s.forEach(l=>{const a=document.createElement("script");a.src=l,a.onload=()=>{t++,t===s.length&&e()},document.head.appendChild(a)})})}function h(e){let t=new DOMParser().parseFromString(e,"text/html");return t.querySelectorAll('a[href*="://"]').forEach(a=>{a.setAttribute("target","_blank")}),t.documentElement.outerHTML}window.Alpine=o;o.store("challenge",{data:{view:""}});o.data("Hint",()=>({id:null,html:null,async showHint(e){if(e.target.open){let s=await i.pages.challenge.loadHint(this.id);if(s.errors){e.target.open=!1,i._functions.challenge.displayUnlockError(s);return}let t=s.data;if(t.content)this.html=h(t.html);else if(await i.pages.challenge.displayUnlock(this.id)){let a=await i.pages.challenge.loadUnlock(this.id);if(a.success){let u=(await i.pages.challenge.loadHint(this.id)).data;this.html=h(u.html)}else e.target.open=!1,i._functions.challenge.displayUnlockError(a)}else e.target.open=!1}}}));o.data("Challenge",()=>({id:null,next_id:null,submission:"",tab:null,solves:[],submissions:[],solution:null,response:null,share_url:null,max_attempts:0,attempts:0,ratingValue:0,hoveredRating:0,selectedRating:0,ratingReview:"",ratingSubmitted:!1,async init(){g()},getStyles(){let e={"modal-dialog":!0};try{switch(i.config.themeSettings.challenge_window_size){case"sm":e["modal-sm"]=!0;break;case"lg":e["modal-lg"]=!0;break;case"xl":e["modal-xl"]=!0;break;default:break}}catch(s){console.log("Error processing challenge_window_size"),console.log(s)}return e},async showChallenge(){new r(this.$el).show()},async showSolves(){this.solves=await i.pages.challenge.loadSolves(this.id),this.solves.forEach(e=>(e.date=d(e.date).format("MMMM Do, h:mm:ss A"),e)),new r(this.$el).show()},async showSubmissions(){let e=await i.pages.users.userSubmissions("me",this.id);this.submissions=e.data,this.submissions.forEach(s=>(s.date=d(s.date).format("MMMM Do, h:mm:ss A"),s)),new r(this.$el).show()},getSolutionId(){return o.store("challenge").data.solution_id},async showSolution(){let e=this.getSolutionId();i._functions.challenge.displaySolution=s=>{this.solution=s.html,new r(this.$el).show()},await i.pages.challenge.displaySolution(e)},getNextId(){return o.store("challenge").data.next_id},async nextChallenge(){let e=c.getOrCreateInstance("[x-ref='challengeWindow']");e._element.addEventListener("hidden.bs.modal",s=>{o.nextTick(()=>{this.$dispatch("load-challenge",this.getNextId())})},{once:!0}),e.hide()},async getShareUrl(){let e={type:"solve",challenge_id:this.id};const l=(await(await i.fetch("/api/v1/shares",{method:"POST",body:JSON.stringify(e)})).json()).data.url;this.share_url=l},copyShareUrl(){navigator.clipboard.writeText(this.share_url);let e=p.getOrCreateInstance(this.$el);e.enable(),e.show(),setTimeout(()=>{e.hide(),e.disable()},2e3)},async submitChallenge(){this.response=await i.pages.challenge.submitChallenge(this.id,this.submission),await this.renderSubmissionResponse()},async renderSubmissionResponse(){this.response.data.status==="correct"&&(this.submission=""),this.max_attempts>0&&this.response.data.status!="already_solved"&&this.response.data.status!="ratelimited"&&(this.attempts+=1),this.$dispatch("load-challenges")},async submitRating(){(await i.pages.challenge.submitRating(this.id,this.selectedRating,this.ratingReview)).value?(this.ratingValue=this.selectedRating,this.ratingSubmitted=!0):alert("Error submitting rating")}}));o.data("ChallengeMap",()=>({loaded:!1,challenges:[],challenge:null,states:{},states_used:[],chal_areas:{},categories:[],category_colors:[],async init(){if(this.challenges=await i.pages.challenges.getChallenges(),await m(),this.loaded=!0,this.initializeMap(),window.location.hash){let e=decodeURIComponent(window.location.hash.substring(1)),s=e.lastIndexOf("-");if(s>=0){let l=[e.slice(0,s),e.slice(s+1)][1];await this.loadChallenge(l)}}},initializeMap(){this.states={DE:1,PA:2,NJ:3,GA:4,CT:5,MA:6,MD:7,SC:8,NH:9,VA:10,NY:11,NC:12,RI:13,VT:14,KY:15,TN:16,OH:17,LA:18,IN:19,MS:20,IL:21,AL:22,ME:23,MO:24,AR:25,MI:26,FL:27,TX:28,IA:29,WI:30,CA:31,MN:32,OR:33,KS:34,WV:35,NV:36,NE:37,CO:38,ND:39,SD:40,MT:41,WA:42,ID:43,WY:44,UT:45,OK:46,NM:47,AZ:48,AK:49,HI:50},this.states_used=[],this.chal_areas={},this.categories=[],this.category_colors=[],this.mapChallengesToStates(),this.createMap()},mapChallengesToStates(){const e=Object.keys(this.states),s=[];this.challenges.forEach((t,l)=>{this.categories.includes(t.category)||this.categories.push(t.category);let a=!1;if(t.tags.forEach(n=>{this.states[n.value]&&!this.states_used.includes(n.value)&&(this.chal_areas[n.value]={value:t.category,tooltip:{content:`<span style="font-weight:bold;">${t.category} ${parseInt(t.value)}: ${t.name}</span>`}},this.states_used.push(n.value),this.states[n.value]=t.id,s.push(t.id),a=!0)}),!a){const n=e[l%e.length];this.states_used.includes(n)||(this.chal_areas[n]={value:t.category,tooltip:{content:`<span style="font-weight:bold;">${t.category} ${parseInt(t.value)}: ${t.name}</span>`}},this.states_used.push(n),this.states[n]=t.id,s.push(t.id))}}),this.categories.forEach(t=>{this.category_colors.push({attrs:{fill:this.colorHash(t)},label:t,sliceValue:t})})},colorHash(e){let s=0;for(let a=0;a<e.length;a++)s+=e.charCodeAt(a);let t="";const l=s/8;for(let a=l;a<=s&&(t+=a.toString(16).replace(/\W/g,""),!(t.length>=6));a+=l);return"#"+t.substring(0,6)},createMap(){this.$nextTick(()=>{const e=this.$refs.mapContainer;e&&window.jQuery&&window.jQuery.mapael&&$(e).mapael({map:{name:"usa_states",defaultArea:{attrs:{fill:"#eee",stroke:"#ddd",cursor:"pointer"},text:{attrs:{"font-size":10,"font-family":"Arial, Helvetica, sans-serif"},attrsHover:{"font-size":14,"font-family":"Arial, Helvetica, sans-serif"}},attrsHover:{animDuration:200,fill:"#555"},eventHandlers:{click:(s,t,l,a)=>{if(!this.states_used.includes(t))return;const n=this.states[t];this.loadChallenge(n)}}}},legend:{area:{title:"Categories",slices:this.category_colors}},areas:this.chal_areas})})},async loadChallenges(){this.challenges=await i.pages.challenges.getChallenges(),this.initializeMap()},async loadChallenge(e){await i.pages.challenge.displayChallenge(e,s=>{s.data.view=h(s.data.view),o.store("challenge").data=s.data,o.nextTick(()=>{let t=c.getOrCreateInstance("[x-ref='challengeWindow']");t._element.addEventListener("hidden.bs.modal",l=>{history.replaceState(null,null," ")},{once:!0}),t.show(),history.replaceState(null,null,`#${s.data.name}-${e}`)})})}}));o.start();
